```c
int __fastcall writeToFlash(unsigned int chainIndex, __int16 command, __int16 subCommand, int dataArray, int dataSize)
{
  int flashFileDescriptor; // r10
  int status; // r4
  int bytesToWrite; // r7
  __int16 dataSum; // r5
  unsigned __int8 *dataPointer; // r6
  char *dataBufferPointer; // r2
  unsigned int dataValue; // r3
  unsigned int tempData; // t1
  __int16 writeCommandPrefix; // [sp+Ch] [bp-84Ch] BYREF
  __int16 readCommandPrefix; // [sp+10h] [bp-848h] BYREF
  char dataSizePlusSix; // [sp+12h] [bp-846h]
  char dataSizeByte; // [sp+13h] [bp-845h]
  char commandByte; // [sp+14h] [bp-844h]
  char subCommandByte; // [sp+15h] [bp-843h]
  int initialZeros1; // [sp+16h] [bp-842h]
  int initialZeros2; // [sp+1Ah] [bp-83Eh]
  int initialZeros3; // [sp+1Eh] [bp-83Ah]
  int initialZeros4; // [sp+22h] [bp-836h]
  int initialZeros5; // [sp+26h] [bp-832h]
  int initialZeros6; // [sp+2Ah] [bp-82Eh]
  __int16 initialZeros7; // [sp+2Eh] [bp-82Ah]
  char debugBuffer[2048]; // [sp+30h] [bp-828h] BYREF

  if ( chainIndex > 0xF )
  {
    snprintf(debugBuffer, 0x800u, "%s: Bad pic param, input chain is %d\n", "writeToFlash", chainIndex);
    status = -2147483135;
    logMessage(0, debugBuffer, 0);
    return status;
  }
  if ( !chainDescriptorArray[2 * chainIndex + 1] )
  {
    status = initPic(chainIndex);
    if ( status < 0 )
    {
      snprintf(debugBuffer, 0x800u, "%s: auto exec open_pic, but chain %d open eeprom failed\n", "writeToFlash", chainIndex);
      logMessage(0, debugBuffer, 0);
      return status;
    }
  }
  flashFileDescriptor = chainDescriptorArray[2 * chainIndex];
  status = 0;
  pthread_mutex_lock(&flashOperationMutex);
  if ( dataSize >= 16 )
    bytesToWrite = 16;
  else
    bytesToWrite = dataSize;
  subCommandByte = command;
  dataSizePlusSix = dataSize + 6;
  commandByte = subCommand;
  dataSum = (unsigned __int8)(dataSize + 6) + command + 53 + subCommand;
  writeCommandPrefix = -21931;
  readCommandPrefix = 0;
  initialZeros1 = 0;
  initialZeros2 = 0;
  initialZeros3 = 0;
  initialZeros4 = 0;
  initialZeros5 = 0;
  initialZeros6 = 0;
  initialZeros7 = 0;
  dataSizeByte = 53;
  if ( dataSize > 0 )
  {
    dataPointer = (unsigned __int8 *)(dataArray - 1);
    do
    {
      tempData = *++dataPointer;
      dataValue = tempData;
      if ( (status & 1) == 0 && dataValue > 0x3F )
      {
        snprintf(debugBuffer, 0x800u, "%s: the data[%d] must less than 0x3f\n", "writeToFlash_debug", status);
        logMessage(status & 1, debugBuffer, status & 1);
        LOWORD(dataValue) = *dataPointer;
      }
      dataBufferPointer = (char *)&readCommandPrefix + status++;
      dataBufferPointer[6] = dataValue;
      dataSum += dataValue;
    }
    while ( bytesToWrite > status );
  }
  *((_BYTE *)&readCommandPrefix + (unsigned __int16)(bytesToWrite + 6)) = HIBYTE(dataSum);
  *((_BYTE *)&readCommandPrefix + (unsigned __int16)(bytesToWrite + 7)) = dataSum;
  if ( writeI2CData(flashFileDescriptor, (int)&readCommandPrefix, (unsigned __int16)(bytesToWrite + 8)) == (unsigned __int16)(bytesToWrite + 8) )
  {
    usleep(0x493E0u);
    if ( readI2CData(flashFileDescriptor, &writeCommandPrefix, 2) == 2 )
    {
      if ( (unsigned __int8)writeCommandPrefix != 53 || HIBYTE(writeCommandPrefix) != 1 )
      {
        status = 0;
        snprintf(
          debugBuffer,
          0x800u,
          "%s failed 2! read_back_data[0] = 0x%02x, read_back_data[1] = 0x%02x\n\n",
          "writeToFlash_debug",
          (unsigned __int8)writeCommandPrefix,
          HIBYTE(writeCommandPrefix));
        logMessage(0, debugBuffer, 0);
      }
      goto END_WRITE;
    }
    snprintf(debugBuffer, 0x800u, "%s read iic 2 err\n", "writeToFlash_debug");
  }
  else
  {
    snprintf(debugBuffer, 0x800u, "%s write iic 2 err\n", "writeToFlash_debug");
  }
  status = 0;
  logMessage(0, debugBuffer, 0);
END_WRITE:
  pthread_mutex_unlock(&flashOperationMutex);
  return status;
}
```