```c
int setFanSpeedControl()
{
  int minPicTemp; // r7
  int maxPicTemp; // r5
  int maxChipTemp; // r6
  int result; // r0
  int tempDiff; // r2
  int fanSpeedAdjustCount; // r2
  int adjustThreshold; // r3
  int lastDiffContinuousTime; // r8
  bool condition; // cc
  int logValue; // r0
  unsigned __int8 increasePwm; // r4
  int newFanSpeed; // r4
  int logValue2; // r0
  unsigned __int8 decreasePwm; // r4
  int logValue3; // r0
  char logBuffer[2080]; // [sp+18h] [bp-820h] BYREF

  if ( (fanFixedFlag & 2) != 0 && fanFixedValue <= 0x64u )
  {
    result = setFixedFanSpeed(fanFixedValue);
    if ( !isFanSpeedFixed )
    {
      if ( globalLogLevel > 3 )
      {
        snprintf(logBuffer, 0x800u, "fan_etf: Set fixed fan speed=%d\n", fanFixedValue);
        result = logMessage(3, logBuffer, 0);
      }
      isFanSpeedFixed = 1;
    }
    return result;
  }
  minPicTemp = getMinPicTemp();
  maxPicTemp = getMaxPicTemp();
  maxChipTemp = getMaxChipTemp();
  result = maxPicTemp - getMinPicTemp();
  if ( lastPicTemp == 255 )
  {
    fanSpeedAdjustCount = fanSpeedAdjustCounter;
LABEL_25:
    fanSpeedHasBeenAdjusted = fanSpeedAdjustCount > 1;
    fanSpeedAdjustCounter = (fanSpeedAdjustCount - 1) & ~((fanSpeedAdjustCount - 1) >> 31);
    goto LABEL_10;
  }
  tempDiff = lastPicTemp - minPicTemp;
  if ( lastPicTemp - minPicTemp < 0 )
    tempDiff = minPicTemp - lastPicTemp;
  condition = tempDiff <= 4;
  fanSpeedAdjustCount = fanSpeedAdjustCounter;
  if ( condition )
    goto LABEL_25;
  adjustThreshold = fanSpeedAdjustCounter + 1;
  if ( fanSpeedAdjustCounter + 1 >= 2 )
    adjustThreshold = 2;
  fanSpeedAdjustCounter = adjustThreshold;
  fanSpeedHasBeenAdjusted = fanSpeedAdjustCount > 0;
LABEL_10:
  lastPicTemp = minPicTemp;
  if ( maxPicTemp > 72 )
    goto LABEL_14;
  lastDiffContinuousTime = abs32(result);
  condition = lastDiffContinuousTime <= 32;
  if ( lastDiffContinuousTime <= 32 )
    condition = minPicTemp <= 50;
  if ( !condition || fanSpeedHasBeenAdjusted )
  {
LABEL_14:
    if ( !isFanSpeedFixed )
    {
      if ( globalLogLevel > 4 )
      {
        snprintf(
          logBuffer,
          0x800u,
          "min pic temp = %d max pic temp = %d pic diff = %d, max chip temp = %d, last diff continuous_time = %d",
          minPicTemp,
          maxPicTemp,
          result,
          maxChipTemp,
          fanSpeedAdjustCounter);
        logMessage(4, logBuffer, 0);
      }
      isFanSpeedFixed = 1;
    }
    return setFixedFanSpeed(100);
  }
  else
  {
    isFanSpeedFixed = 0;
    if ( lastDiffContinuousTime > 27 )
    {
      increasePwm = (unsigned int)(float)((float)((float)((float)lastDiffContinuousTime - 25.0) / 25.0) * 10.0);
      if ( increasePwm + getCurrentFanSpeed() <= 99 )
        newFanSpeed = increasePwm + getCurrentFanSpeed();
      else
        newFanSpeed = 100;
      if ( globalLogLevel > 4 )
      {
        logValue2 = getCurrentFanSpeed();
        snprintf(logBuffer, 0x800u, "max temp = %04d, diff = %04d, + pwm form %04d to %04d\n", maxPicTemp, lastDiffContinuousTime, logValue2, newFanSpeed);
        logMessage(4, logBuffer, 0);
      }
      return setFixedFanSpeed(newFanSpeed);
    }
    if ( lastDiffContinuousTime > 22 )
    {
      if ( globalLogLevel > 4 )
      {
        logValue = getCurrentFanSpeed();
        snprintf(logBuffer, 0x800u, "max temp = %04d, diff = %04d, = pwm %04d\n", maxPicTemp, lastDiffContinuousTime, logValue);
        return logMessage(4, logBuffer, 0);
      }
      return result;
    }
    decreasePwm = (unsigned int)(float)((float)((float)(25.0 - (float)lastDiffContinuousTime) / 25.0) * 10.0);
    result = getCurrentFanSpeed() - decreasePwm;
    if ( result > 39 )
    {
      result = getCurrentFanSpeed();
      newFanSpeed = result - decreasePwm;
    }
    else
    {
      newFanSpeed = 40;
    }
    if ( globalLogLevel > 4 )
    {
      logValue3 = getCurrentFanSpeed();
      snprintf(logBuffer, 0x800u, "max temp = %04d, diff = %04d, - pwm form %04d to %04d\n", maxPicTemp, lastDiffContinuousTime, logValue3, newFanSpeed);
      result = logMessage(4, logBuffer, 0);
    }
    if ( maxPicTemp <= 67 )
      return setFixedFanSpeed(newFanSpeed);
  }
  return result;
}
```