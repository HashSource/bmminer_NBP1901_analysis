```c
int calculateHashRate(void)
{
  int totalHashRate;
  int individualHashRate;
  int hashRateFactor;
  int chipFrequency;
  uint minimumTemperature;
  uint chipTemperature;
  int chipIndex;
  uint temperatureThreshold;
  char loggingBuffer[2052];
  
  // If the operating mode is set to mode 2, calculate total hash rate differently
  if (operatingMode == 2) {
    totalHashRate = 0;
    individualHashRate = 0;
    chipFrequency = readChipFrequency(0);
    while( true ) {
      if (chipFrequency != 0) {
        hashRateFactor = hashRateFactors[chipIndex];
        chipFrequency = getCurrentFrequency();
        individualHashRate = getCurrentHashRate();
        totalHashRate = individualHashRate * chipFrequency * hashRateFactor + totalHashRate;
      }
      chipIndex = chipIndex + 1;
      if (chipIndex == 4) break;
      chipFrequency = readChipFrequency(chipIndex);
    }
  }
  else {
    totalHashRate = 0;
    minimumTemperature = 0;
    do {
      individualHashRate = readChipFrequency(chipIndex);
      chipTemperature = minimumTemperature;
      if ((((individualHashRate != 0) &&
           (chipTemperature = readTemperature(chipIndex), chipTemperature == 0)) &&
          (chipTemperature = temperatureThreshold, minimumTemperature != 0)) &&
          (chipTemperature = minimumTemperature, temperatureThreshold <= minimumTemperature)) {
        chipTemperature = temperatureThreshold;
      }
      chipIndex = chipIndex + 1;
      minimumTemperature = chipTemperature;
    } while (chipIndex != 4);
    totalHashRate = 0;
    chipIndex = 0;
    do {
      chipFrequency = chipIndex + 1;
      individualHashRate = readChipFrequency(chipIndex);
      if (individualHashRate != 0) {
        chipFrequency = getCurrentFrequency();
        hashRateFactor = getCurrentHashRate();
        totalHashRate = hashRateFactor * minimumTemperature * chipFrequency + totalHashRate;
      }
      chipIndex = chipFrequency;
    } while (chipFrequency != 4);
  }
  // Divide by 1000 to get the hash rate in Kilo Hash per second
  hashRateInKiloHashes = totalHashRate / 1000;
  // If log level is higher than 4, log the calculated ideal hash rate
  if (logLevel > 4) {
    snprintf(loggingBuffer, 0x800, "ideal_hash_rate = %d\n", hashRateInKiloHashes);
    writeToLog(4, loggingBuffer, 0);
  }
  return hashRateInKiloHashes; // Return the hash rate in Kilo Hash per second
}
```

Please note that without the complete original code, including global variable declarations, type definitions, and functions like `readChipFrequency`, `getCurrentFrequency`, `getCurrentHashRate`, `readTemperature`, and `writeToLog`, some assumptions have been made about functionality and naming. Comments in the code now describe the purpose and logic within the modified function as interpreted from the decompiled code.