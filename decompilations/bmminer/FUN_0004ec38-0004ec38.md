```c
// Function to release resources allocated for the task
uint32_t release_task_resources(int *task_ptr)
{
  bool successfully_acquired_lock;
  int current_resource_handle;
  uint resource_count;
  int *resource_ref_count_ptr;
  uint resource_index;
  
  if ((task_ptr != NULL) && (*task_ptr == 1)) { // Check if task pointer is valid and task is active
    resource_count = task_ptr[3]; // Get the number of resources
    if (resource_count != 0) { // If there are resources to release
      resource_index = 0;
      do {
        // Get handle to the current resource
        current_resource_handle = *(int *)(task_ptr[4] + resource_index * 4);
        // Check if the resource handle is valid
        if ((current_resource_handle != 0) && 
            (resource_ref_count_ptr = (int *)(current_resource_handle + 4), 
            *(int *)(current_resource_handle + 4) != -1)) {
          // Synchronize access to ensure data consistency
          DataMemoryBarrier(0xb);
          do {
            // Get current reference count
            current_resource_handle = *resource_ref_count_ptr;
            // Check if we have exclusive access to the resource reference count
            successfully_acquired_lock = (bool)hasExclusiveAccess(resource_ref_count_ptr);
          } while (!successfully_acquired_lock); // Keep trying until lock is acquired
          // Decrement reference count
          *resource_ref_count_ptr = current_resource_handle - 1;
          // If reference count has reached zero, release the resource
          if (current_resource_handle - 1 == 0) {
            cleanup_resource();
          }
          // Re-fetch resource count as releasing resources may modify it
          resource_count = task_ptr[3];
        }
        resource_index = resource_index + 1;
      } while (resource_index < resource_count); // Loop through all resources
    }
    task_ptr[3] = 0; // No more resources to release
    return 0;
  }
  return 0xffffffff; // Return failure code if task pointer is invalid or task is not active
}
```