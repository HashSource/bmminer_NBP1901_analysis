```c
int calculate_max_hashrate(void) {
  size_t numberOfHashboards;
  int *hashRateArray;
  int hashRate;
  int tempHashRate;
  int sumHashRate;
  int totalHashRate;
  int *currentPtr;
  int *nextPtr;
  
  // Get the number of hashboards from another function
  numberOfHashboards = get_number_of_hashboards();

  // Allocate memory to store the hashrate of each hashboard
  hashRateArray = (int *)calloc(numberOfHashboards, sizeof(int));

  if (hashRateArray == NULL) { // Check if memory allocation failed
    sumHashRate = 0;
    if (debug_level > 3) {
      log_error("malloc_buf_failed");
    }
  } else {
    sumHashRate = 0;
    if (hashboard_operation_mode == 2) {
      totalHashRate = 0;
      hashRate = get_hashrate_for_board(0);
      for (int boardIndex = 0; boardIndex < 4; boardIndex++) {
        if (hashRate != 0) {
          tempHashRate = hashboard_multipliers[boardIndex];
          numberOfHashboards = get_number_of_hashboards();
          int singleBoardHashRate = get_single_board_hashrate();
          sumHashRate = singleBoardHashRate * numberOfHashboards * tempHashRate + sumHashRate;
        }
        hashRate = get_hashrate_for_board(boardIndex + 1);
      }
    } else {
      for (int boardIndex = 0; boardIndex < 4; boardIndex++) {
        hashRate = get_hashrate_for_board(boardIndex);
        if (hashRate != 0) {
          get_board_hashrate_array(boardIndex, (undefined)configured_value, hashRateArray);
          numberOfHashboards = get_number_of_hashboards();
          if (numberOfHashboards > 0) {
            currentPtr = hashRateArray;
            do {
              nextPtr = currentPtr + 1;
              tempHashRate = *currentPtr;
              int singleBoardHashRate = get_single_board_hashrate();
              sumHashRate = tempHashRate * singleBoardHashRate + sumHashRate;
              currentPtr = nextPtr;
            } while (nextPtr != hashRateArray + numberOfHashboards);
          }
        }
      }
    }

    // Calculate total hashrate in KH/s
    total_hashrate_in_kHs = sumHashRate / 1000;
    
    // Log if debug level is higher than 4
    if (debug_level > 4) {
      char logMessage[2048];
      snprintf(logMessage, sizeof(logMessage), "max_hash_rate = %d\n", total_hashrate_in_kHs);
      log_debug(logMessage);
    }

    // Set return value to total hashrate
    sumHashRate = total_hashrate_in_kHs;
    
    // Free allocated memory
    free(hashRateArray);
  }
  return sumHashRate;
}

```